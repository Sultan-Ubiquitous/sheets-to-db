<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SheetSync Manager</title>
    <style>
        :root { --primary: #4285F4; --bg: #f4f6f8; --text: #333; --border: #ddd; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem; }
        h1 { margin: 0; font-size: 1.5rem; }
        .btn { cursor: pointer; padding: 0.5rem 1rem; border: none; border-radius: 4px; font-weight: 500; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-google { background: var(--primary); color: white; text-decoration: none; }
        .btn-submit { background: #0F9D58; color: white; }
        .btn-delete { background: #DB4437; color: white; padding: 0.25rem 0.5rem; font-size: 0.85rem; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 10px; align-items: end; background: #fafafa; padding: 1rem; border-radius: 6px; margin-bottom: 2rem; }
        .input-group { display: flex; flex-direction: column; }
        label { font-size: 0.8rem; margin-bottom: 4px; color: #666; }
        input[type="text"], input[type="number"] { padding: 8px; border: 1px solid var(--border); border-radius: 4px; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid var(--border); }
        th { font-weight: 600; color: #555; }
        tr:last-child td { border-bottom: none; }
        
        #notification { position: fixed; bottom: 20px; right: 20px; padding: 10px 20px; background: #333; color: white; border-radius: 4px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Inventory Manager</h1>
        <div id="auth-section">
            <a href="/auth/google/login" class="btn btn-google">Login with Google</a>
        </div>
    </header>

    <div class="form-grid">
        <div class="input-group">
            <label>Product Name</label>
            <input type="text" id="pName" placeholder="e.g. Wireless Mouse">
        </div>
        <div class="input-group">
            <label>Quantity</label>
            <input type="number" id="pQty" placeholder="0">
        </div>
        <div class="input-group">
            <label>Price</label>
            <input type="number" id="pPrice" step="0.01" placeholder="0.00">
        </div>
        <div class="input-group">
            <label>Discount?</label>
            <select id="pDisc" style="padding: 8px; border: 1px solid var(--border); border-radius: 4px;">
                <option value="false">No</option>
                <option value="true">Yes</option>
            </select>
        </div>
        <button onclick="addProduct()" class="btn btn-submit">Add Product</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>UUID</th>
                <th>Name</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Discount</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="product-list">
            </tbody>
    </table>
</div>

<div id="notification"></div>

<script>
    async function loadProducts() {
        const res = await fetch('/api/products');
        const products = await res.json();
        const tbody = document.getElementById('product-list');
        tbody.innerHTML = '';

        products.forEach(p => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td style="font-family: monospace; font-size: 0.85rem; color: #777;">${p.uuid}</td>
                <td contenteditable="true" onblur="updateProduct('${p.uuid}', 'product_name', this.innerText)">${p.product_name}</td>
                <td contenteditable="true" onblur="updateProduct('${p.uuid}', 'quantity', this.innerText)">${p.quantity}</td>
                <td contenteditable="true" onblur="updateProduct('${p.uuid}', 'price', this.innerText)">${p.price}</td>
                <td>${p.discount ? '✅' : '❌'}</td>
                <td><button onclick="deleteProduct('${p.uuid}')" class="btn btn-delete">Delete</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    async function addProduct() {
        const name = document.getElementById('pName').value;
        const qty = parseInt(document.getElementById('pQty').value);
        const price = parseFloat(document.getElementById('pPrice').value);
        const discount = document.getElementById('pDisc').value === 'true';

        if (!name) return alert("Name is required");

        const res = await fetch('/api/products', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ product_name: name, quantity: qty, price: price, discount: discount })
        });

        if (res.ok) {
            showToast("Product added!");
            document.getElementById('pName').value = ''; 
            loadProducts();
        }
    }

    async function updateProduct(uuid, field, value) {
        if (field === 'quantity') value = parseInt(value);
        if (field === 'price') value = parseFloat(value);

        await fetch(`/api/products/${uuid}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ [field]: value })
        });
        showToast("Product updated");
    }

    async function deleteProduct(uuid) {
        if(!confirm("Are you sure?")) return;
        
        await fetch(`/api/products/${uuid}`, { method: 'DELETE' });
        showToast("Product deleted");
        loadProducts();
    }

    function showToast(msg) {
        const el = document.getElementById('notification');
        el.innerText = msg;
        el.style.display = 'block';
        setTimeout(() => el.style.display = 'none', 3000);
    }

    loadProducts();
</script>
</body>
</html>